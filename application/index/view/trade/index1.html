<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="keywords" content="your keywords">
<meta name="description" content="your description">
<meta name="author" content="author,email address">
<meta name="robots" content="index,follow">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
<meta name="renderer" content="webkit"/>
<meta name="force-rendering" content="webkit"/>
<link type="text/css" rel="stylesheet" href="/static/index/css/swiper.min.css" />
<link type="text/css" rel="stylesheet" href="/static/index/css/animate.min.css" />
<link type="text/css" rel="stylesheet" href="/static/index/css/app_new.css" />
<link rel="stylesheet" href="/static/admin/lib/layui/css/layui.css"/>
<script type="text/javascript" src="/static/index/js/jquery-2.1.1.min.js"></script>
<script src="/static/admin/lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/admin/js/xadmin.js"></script>
<script src="/static/index/js/echarts.min.js"></script>
<title>aioq.cn艾比特数字资产价值兑换交易平台_区块链服务平台【艾比特】</title>
    <style type="text/css">
    .models {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 9999;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
    }

    .models-content {
        position: fixed;
        width: 400px;
        height: 38rem;
        background: #FFFFFF;
        left: 50%;
        top: 50%;
        margin-left: -200px;
        margin-top: -260px;
        padding: 15px 20px;
        text-align: center;
        border-radius: 8px;

    }

    .models-content p {
        font-size: 16px;
        color: black;
        text-align: left;
        margin-bottom: 20px;
    }

    .models-content button {
        outline: none;
        border: none;
        background: #4f94e7;
        width: 80px;
        padding: 5px 0;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 15px;
    }

    .models .itemcon span {
        float: left;
        width: 18%;
        text-align: center;
        height: 30px;
        line-height: 30px;
        font-size: 14px;
        margin-top: 8px;
        color: black;
    }

    .models .item .chosecontype {
        float: right;
        margin-top: 8px;
        width: 80%;
        height: 30px;
        line-height: 30px;
        box-sizing: border-box;
        border: 1px solid #353a59;
        border-radius: 2px;
        text-align: center;
        position: relative;
        font-size: 14px;
        color: black;
    }

    .models .chosecontype .con {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        bottom: 0;
        color: black;
    }

    .models .itemcon .chosecontype {
        float: right;
        margin-top: 8px;
        width: 80%;
        height: 30px;
        line-height: 30px;
        box-sizing: border-box;
        border: 1px solid #353a59;
        border-radius: 2px;
        text-align: center;
        position: relative;
        font-size: 14px;
    }

    .models .itemcon .chosecon {
        float: right;
        margin-top: 8px;
        width: 80%;
        height: 30px;
        line-height: 30px;
        box-sizing: border-box;
        border: 1px solid #353a59;
        border-radius: 2px;
        text-align: center;
        position: relative;
        font-size: 14px;
    }

    .models .chosecontype .btm {
        position: absolute;
        right: 10px;
        color: #b5b5b5;
        font-size: 20px;
        z-index: 200;
        cursor: pointer;
        color: black;
    }

    .models .more {
        width: 100%;
        box-sizing: border-box;
        padding: 15px 0;
        color: black;
        position: inherit;
        top: 0;

        left: 0;
    }

    .models .moretit {
        position: relative;
        font-size: 14px;
        box-sizing: border-box;
        padding-left: 10px;
        color: black;
    }

    .models .more .moretit i {
        position: absolute;
        right: 10px;
        font-size: 16px;
        color: #b5b5b5;
        cursor: pointer;
        color: black;
    }

    .models .moresize {
        width: 100%;
        font-size: 14px;
        text-align: center;
        margin-top: 15px;
        line-height: 20px;
        /*color: #999;*/
        color: black;
    }

    .models .more .moreitemcon {
        width: 100%;
        box-sizing: border-box;
        padding: 0 10px;
        color: black;
    }

    .models .moreitemcon span {
        float: left;
        margin-top: 15px;
        width: 10%;
        text-align: center;
        height: 35px;
        line-height: 35px;
        font-size: 14px;
        margin-left: 10px;
        color: black;
    }

    .models .moreitemcon .one[data-v-c4371006] {
        float: right;
        width: 80%;
        margin: 0 auto;
        color: black;
    }

    .models .more .moreitemcon .morechosecon[data-v-c4371006] {
        float: left;
        margin-right: 20px;
        margin-top: 15px;
        width: 170px;
        height: 30px;
        line-height: 30px;
        box-sizing: border-box;
        border: 1px solid #353a59;
        border-radius: 2px;
        text-align: center;
        position: relative;
        color: black;
    }

    .models .morechosecon .jian[data-v-c4371006] {
        position: absolute;
        left: 5px;
        color: #b5b5b5;
        font-size: 20px;
        color: black;
        cursor: pointer;
    }

    .models .more .moreitemcon .morechosecon input[data-v-c4371006] {
        background: transparent;
        margin-top: -4px;
        color: #fff;
        text-align: center;
        font-size: 14px;
        width: 130px;
        color: black;
    }

    .models .morechosecon .jia[data-v-c4371006] {
        position: absolute;
        right: 5px;
        color: #b5b5b5;
        font-size: 20px;
        cursor: pointer;
        color: black;
    }

    .models .more .moreitemcon .a[data-v-c4371006] {
        width: 60px;
        float: left;
        margin-top: 15px;
        height: 30px;
        line-height: 26px;
        font-size: 14px;
        box-sizing: border-box;
        border: 1px solid #353a59;
        border-radius: 4px;
        background: #bd0000;
        text-align: center;
        margin-right: 5px;
        cursor: pointer;
        color: black;
    }
    .models .chosecontype .eaffer {
        position: relative;
    }

    .models .chosecontype .eaffer:after {
        content: "/手";
        position: absolute;
        width: 20px;
        height: 15px;
        right: 75px;
        top: 0;
    }

    .models .layui-input-block {
        text-align: left;
        margin-left: 9px;

        width: 63px;
        margin-top: 5px;
        float: left;
    }

    .models .more{
        padding: 0px;
    }
    .models-content button{
        margin-top: 4px;
    }
    .models input{
        border: none;
        width: 100%;
    }
    </style>
</head>
<body>
<div class="pulic_tip_box">
  <!--<div class="logo_box">-->
     <!--<a href="#"><img src="i/logo.png" alt=""></a>-->
  <!--</div>-->
  <ul class="nav">
      <li>
          <a href="/index/Index/index">首页</a>
      </li>
      <li>
          <a href="/index/Trade/index">交易中心
          </a>
      </li>
      <li>
          <a href="/index/Coin/index">申购币</a>
      </li>
      <li>
          <a href="/index/Notice/index">公告中心</a>
      </li>
      <li>
          <a href="/index/Notice/help">帮助中心</a>
      </li>
      <li>
          <a href="/index/Notice/about_us">关于我们</a>
      </li>
      <li>
          <a href="/index/User/index">个人中心</a>
      </li>
  </ul>
  <div class="tip_user">
    <div class="rel">
      <a href="/index/User/index">
        <img src="/static/index/images/user.png" alt="">
      </a>
    </div>
  </div>
</div>
<!-- -->
<div class="contain_kline_box clear">
 <div class="sidebar">
  <div class="coinsymbol">
   <div class="tle">
     市场
   </div>
   <div class="extab">
     <dt>
       <span class="des">币种</span>
       <span class="des">最新价</span>
       <span class="des">涨跌</span>
       <span class="des">涨幅</span>
     </dt>


      <div class="product_list">
          {volist name="product_list" id="val"}
          <div class="symbolitem" data-product-abbreviation-name="{$val.abbreviation}">
              <input type="hidden" id="{$val.abbreviation}_id" value="{$val.id}"/>
              <input type="hidden" id="{$val.abbreviation}_contract" value="{$val.contract|number_format=###,2,'.',''}"/>
              <input type="hidden" id="{$val.abbreviation}_min_hand" value="{$val.min_hand|number_format=###,2,'.',''}"/>
              <input type="hidden" id="{$val.abbreviation}_fee" value="{$val.fee|number_format=###,2,'.',''}"/>
              <input type="hidden" id="{$val.abbreviation}_wave" value="{$val.wave}"/>
              <dd>
                  <span class="symbolname title">{$val.desc_name}</span>
                  <span class="price {$val.abbreviation}" data-color="{$val.abbreviation}">0.00</span>
                  <span class="buy " data-product-up-down="{$val['abbreviation']}">0.00</span>
                  <span class="buy "><b  data-product-up-down-val="{$val['abbreviation']}">0.00</b>%</span>
              </dd>
          </div>
          {/volist}
      </div>

   </div>
  </div>
 </div>
 <!-- -->
 <div class="getKwrap">
   <div class="mode_hd">
     <dl>
       <dt class="product_name">{$product['desc_name']}</dt>
       <dd><p class="product_price_change" data-color="{$product.abbreviation}" data-product-abbreviation="{$product['abbreviation']}">0.00</p><p class="des">最新价</p></dd>
       <dd><p  class="up_down" data-product-up-down="{$product['abbreviation']}">0.00</p><p class="des">涨跌</p></dd>
         <dd><p > <b class="up_down_val" data-product-up-down-val="{$product['abbreviation']}">0.00</b> %</p><p class="des">涨幅</p></dd>
     </dl>
     <dl class="liness"></dl>
     <dl>
       <dd><p id ="price-k-high">0.00</p><p class="des">高</p></dd>
       <dd><p id ="price-k-open">0.00</p><p class="des">开</p></dd>
       <dd><p id ="price-k-low">0.00</p><p class="des">低</p></dd>
       <dd><p id ="price-k-close">0.00</p><p class="des">收</p></dd>
       <!--<dd><p>4033 BTC</p><p class="des">24H量</p></dd>-->
     </dl>
   </div>
   <div id="kline_container">
     <div class="time clear">
       <div class="group " gap="1minute">
         <div class="button" title="realtime"><span>1min</span></div>
       </div>
       <div class="group" gap="5minute">
         <div class="button" title="realtime"><span>5min</span></div>
       </div>
       <div class="group" gap="15minute">
         <div class="button" title="realtime"><span>15min</span></div>
       </div>
       <div class="group" gap="30minute">
         <div class="button" title="realtime"><span>30min</span></div>
       </div>
       <div class="group" gap="60minute">
         <div class="button" title="realtime"><span>1hour</span></div>
       </div>
       <div class="group select default_active" gap="1day" count="30">
         <div class="button" title="realtime"><span>1day</span></div>
       </div>
     </div>
     <div class="kxt" style="background-color: #0d161f">

     </div>
   </div>
 </div>
</div>
<!-- -->
<div class="contain_order_box clear">
 <div class="trade_wrap">
   <div class="deal_record_hd">新建订单</div>
   <div class="tradeview">
     <div class="panel">
       <div class="bd_limited">
           <!--<div class="ivu-form-item clear">-->
             <!--<select class="sele" name="">-->
               <!--<option>100x</option>-->
             <!--</select>-->
           <!--</div>-->
           <div class="ivu-form-item clear">
             <input class="int" type="text" name="" placeholder="品种">
             <span class="r_t product_name">{$product['desc_name']}</span>
           </div>
           <div class="ivu-form-item clear">
             <input class="int" type="text" name="" placeholder="交易单位">
             <span class="r_t contract">{$product['contract']|number_format=###,2,'.',''}</span>
           </div>
           <div class="ivu-form-item clear">
             <input class="int" type="text" name="" placeholder="最小手数">
             <span class="r_t min_hand">{$product['min_hand']|number_format=###,2,'.',''}</span>
           </div>

         <!--<div class="usdts clear">-->
           <!--<div>最小下单单位</div>-->
           <!--<div class="min_hand">{$product['min_hand']|number_format=###,2,'.',''}</div>-->
           <!--<div>/手</div>-->
         <!--</div>-->
         <!--<div class="radio-group-button">-->
           <!--<label for="" class="ivu-radio active">-->
             <!--<input type="radio" name="" value="">-->
             <!--10%-->
           <!--</label>-->
           <!--<label for="" class="ivu-radio">-->
             <!--<input type="radio" name="" value="">-->
             <!--20%-->
           <!--</label>-->
           <!--<label for="" class="ivu-radio">-->
             <!--<input type="radio" name="" value="">-->
             <!--50%-->
           <!--</label>-->
           <!--<label for="" class="ivu-radio">-->
             <!--<input type="radio" name="" value="">-->
             <!--100%-->
           <!--</label>-->
         <!--</div>-->
         <div class="line-open-cont">
           <div class="info-right">
             <div class="title">手续费：</div>
             <div class="value fee">{$product['fee']|number_format=###,2,'.',''}</div>
           </div>
         </div>
         <div class="bit_btn_box clear">
           <button class="btn buybtn" type="button" name="button" onclick="set_direction('买入',1)">买入</button>
           <button class="btn sellbtn" type="button" name="button" onclick="set_direction('卖出',2)">卖出</button>
         </div>
       </div>
     </div>
   </div>
 </div>
 <!-- -->
 <div class="trade_wrap">
   <div class="deal_record_hd">我的资产(USD)</div>
   <div class="tradeview">
     <div class="intronum">
       <ul>
         <li><label class="des">账户余额</label><p title="0.00000000USDT"><span id="user_money">{$user.money|number_format=###,2,'.',''}</span>USD</p>
         </li>
         <li><label class="des">占用保证金</label><p title="0.00000000USDT"><span id="user_promise_money">{$user.promise_money|number_format=###,2,'.',''}</span>USD</p>
         </li>
         <li><label class="des">可用余额</label><p title="0.00000000USDT"><span id="user_real_money">{$user.real_money|number_format=###,2,'.',''}</span>USD</p>
         </li>
         <!--<li><label class="des">权益</label><p title="0.00000000USDT"><span>0.00000000</span>USDT</p>-->
         <!--</li>-->
         <!--<li><label class="des">风险率</label><p>0.00%</p>-->
         <!--</li>-->
       </ul>
     </div>
   </div>
 </div>
 <!-- -->
 <div class="open_orders">
   <div class="deal_record_hd">当前持仓</div>
   <div class="ivu-tabs-content">
     <div class="ivu-table-wrapper">
       <table>
         <thead>
           <tr>
               <th>单号</th>
               <th>产品</th>
               <th>保证金</th>
               <th>买入价</th>
               <th>当前价格</th>
               <th>方向</th>
               <th>交易单位</th>
               <th>手数</th>
               <th>盈利金额</th>
               <th>下单时间</th>
               <th >操作</th>
           </tr>
         </thead>
         <tbody class="keep_order_list">
         {volist name="keep_order_list" id="val"}
         <tr class="{$val.oid}">
             <td>{$val['order_sn']}</td>
             <td>{$val['product_name']}</td>
             <td class="money">{$val['money']|number_format=###,2,'.',''}</td>
             <td class="buy_price">{$val['buy_price']|number_format=###,2,'.',''}</td>
             <td class="{$val.product_abbreviation} now_price">0.00</td>
             {if ($val['direction'] eq 1)}
             <td style="color: #e54c4c;" class="direction">买入</td>
             {else/}
             <td style="color: #4bbb82;" class="direction">卖出</td>
             {/if}
             <td class="order_contract">{$val['contract']|number_format=###,2,'.',''}</td>
             <td class="hand">{$val['hand']|number_format=###,2,'.',''}</td>
             <td class="profit">0.00</td>
             <td>{$val['add_time']}</td>
             <td><button style="background-color: #e54c4c;color: white;border-radius:8%;width: 3rem;border: none;" onclick="close_order({$val.oid})">平仓</button></td>
         </tr>
         {/volist}
         </tbody>
       </table>
     </div>
   </div>
 </div>
</div>
</body>

<div class="models">
    <form class="layui-form" action="">
        <div class="models-content">
            <div data-v-c4371006="" class="leftbtm" style="width: 100%;box-sizing: border-box;padding-bottom: 20px;border: 1px solid #353a59;margin-top: 10px;color: black;">
                <div data-v-c4371006="" class="tit" style="width: 100%;height: 42px;line-height: 42px;box-sizing: border-box;padding-left: 20px;font-size: 14px;color: black;">新建订单
                </div>
                <div data-v-c4371006="" class="chose" style="width: 100%;padding: 0 20px;padding-bottom: 12px;box-sizing: border-box;border-top: 1px solid #353a59;border-bottom: 1px dashed #353a59;color: black;">
                    <div data-v-c4371006="" class="itemcon clearfix" style="    width: 100%;"><span
                            data-v-c4371006="">品种</span>
                        <div data-v-c4371006="" class="chosecontype">
                            <div data-v-c4371006="" class="con product_name">{$product_list[0]['desc_name']}</div>
                        </div>
                    </div>
                    <div data-v-c4371006="" class="itemcon clearfix" style="    width: 100%;"><span
                            data-v-c4371006="">当前价格</span>
                        <div data-v-c4371006="" class="chosecontype">
                            <div data-v-c4371006="" class="con product_price_change" data-product-abbreviation="{$product_list[0]['abbreviation']}" >0.00</div>
                        </div>
                    </div>
                    <div data-v-c4371006="" class="itemcon clearfix" style="width: 100%;"><span
                            data-v-c4371006="">交易单位</span>
                        <div data-v-c4371006="" class="chosecontype">
                            <div data-v-c4371006="" class="con eaffer contract">{$product_list[0]['contract']|number_format=###,2,'.',''}</div>
                        </div>
                    </div>
                    <div data-v-c4371006="" class="itemcon clearfix" style="width: 100%;"><span
                            data-v-c4371006="">方向</span>
                        <div data-v-c4371006="" class="chosecontype">
                            <div data-v-c4371006="" class="con  order_direction">买入</div>
                        </div>
                    </div>
                    <div data-v-c4371006="" class="itemcon clearfix" style="overflow: hidden;width: 100%;">
                        <span data-v-c4371006="">手数</span>
                        <div data-v-c4371006="" class="chosecon">
                            <i data-v-c4371006="" class="iconfont icon-jianhaob jian"></i>
                            <input data-v-c4371006="" type="text" value=""  autocomplete="off" placeholder="0" class="shosu" name="hand" style="text-align: center"  lay-verify="number|hand">
                            <i data-v-c4371006=""  lass="iconfont icon-jiahaob jia"></i>
                        </div>
                    </div>
                    <div data-v-c4371006="" class="itemcon clearfix" style="width: 100%;">
                        <span data-v-c4371006="">保证金</span>
                        <div data-v-c4371006="" class="chosecontype">
                            <div data-v-c4371006="" class="con promise_money">0.00</div>
                        </div>
                    </div>
                    <div data-v-c4371006="" class="itemcon clearfix" style="overflow: hidden;width: 100%;">
                        <span data-v-c4371006="">手续费</span>
                        <div data-v-c4371006="" class="chosecontype">
                            <div data-v-c4371006="" class="con fee">{$product_list[0]['fee']|number_format=###,2,'.',''}</div>
                        </div>
                    </div>
                </div>
                <div data-v-c4371006="" class="more" style="display: block;">
                    <input type="hidden" id="point_wave" value="{$product_list[0]['wave']}"/>
                    <div data-v-c4371006="">
                        <div data-v-c4371006="" class="moresize">设置止盈应<span class="win_des">大于</span>等于<span class="target_profit">0.00</span></div>
                        <div data-v-c4371006="" class="moresize">设置止损应<span class="loss_des">小于</span>等于<span class="stop_loss">0.00</span></div>
                        <div data-v-c4371006="" class="itemcon clearfix switchone"  style="overflow: hidden;width: 100%;padding: 0 20px;">
                            <span data-v-c4371006="">止盈</span>
                            <div class="layui-input-block">
                                <input type="checkbox" name="target_profit_check" value="1" lay-filter="checks" lay-skin="switch" lay-text="开启|不设">
                            </div>
                            <div data-v-c4371006="" class="chosecon" style="width: 50%;display: none">
                                <input data-v-c4371006="" type="number" name="target_profit" autocomplete="off" >
                            </div>
                        </div>
                        <div data-v-c4371006="" class="itemcon clearfix switchtwo" style="overflow: hidden;width: 100%;padding: 0 20px;">
                            <span data-v-c4371006="">止损</span>
                            <div class="layui-input-block">
                                <input type="checkbox" name="stop_loss_check" value="1" lay-filter="checks-t" lay-skin="switch" lay-text="开启|不设">
                            </div>
                            <div data-v-c4371006="" class="chosecon" style="width: 50%;display: none">
                                <input data-v-c4371006="" type="number" name="stop_loss" autocomplete="off">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <input type="hidden" name="id" class="form_id" value="{$product_list[0]['id']}"/>
            <input type="hidden" class="form_direction" name="direction" value="1"/>
            <button style="background-color: orange;color: white" type="submit" class="create_order" lay-submit lay-filter="create_order">确定</button>
            <button class="m-cancel" type="button" style="margin-left: 20px; orange;color: white">取消</button>
        </div>
    </form>
</div>
</html>

<script>

//var myChart = echarts.init(document.getElementById('main'));
var loc = window.location;
var baseUrl  = loc.protocol  + '//' + loc.host + '/golang'
//function setCandlestick(coinType,gap,count){
//
//    function setOnUi(dataFromApi){
//        //var myChart = echarts.init(document.getElementById('main'));
//
//        Date.prototype.format = function(fmt) {
//            var o = {
//                "M+" : this.getMonth()+1,                 //月份
//                "d+" : this.getDate(),                    //日
//                "h+" : this.getHours(),                   //小时
//                "m+" : this.getMinutes(),                 //分
//                "s+" : this.getSeconds(),                 //秒
//                "q+" : Math.floor((this.getMonth()+3)/3), //季度
//                "S"  : this.getMilliseconds()             //毫秒
//            };
//            if(/(y+)/.test(fmt)) {
//                fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
//            }
//            for(var k in o) {
//                if(new RegExp("("+ k +")").test(fmt)){
//                    fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
//                }
//            }
//            return fmt;
//        }
//
//        function calculateMA(dayCount, data) {
//            var result = [];
//            for (var i = 0, len = data.length; i < len; i++) {
//                if (i < dayCount) {
//                    result.push('-');
//                    continue;
//                }
//                var sum = 0;
//                for (var j = 0; j < dayCount; j++) {
//                    sum += data[i - j][1];
//                }
//                result.push(sum / dayCount);
//            }
//            return result;
//        }
//
//        var datefmt = "yyyy-MM-dd";
//        if(gap == "hour"){
//            datefmt = "yyyy-MM-dd mm时";
//        }
//        if(gap == "minute"){
//            datefmt = "yyyy-MM-dd mm:hh";
//        }
//
//        var dates = dataFromApi.Data.map(function (item) {
//            return new Date(item.time*1000).format(datefmt);
//        });
//
//        var data = dataFromApi.Data.map(function (item) {
//            return [item.open,item.close,item.low,item.high];
//        });
//
//        var valueToday = dataFromApi.Data[dataFromApi.Data.length - 1];
//        $.each(valueToday,function(k,v){
//            $("#price-k-" +k).text(v);
//        });
//
//        var option = {
//            backgroundColor: '#21202D',
//            legend: {
//                data: ['K线','MA5', 'MA10', 'MA20', 'MA30'],
//                inactiveColor: '#777',
//                align: 'right',
//                textStyle: {
//                    color: '#fff'
//                }
//            },
//            tooltip: {
//                trigger: 'axis',
//                formatter:function(params) {
//
//                    var valuePointTo = dataFromApi.Data[params[0].dataIndex];
//                    //修改dom
//                    $.each(valuePointTo,
//                            function(k, v) {
//                                $("#price-k-" + k).text(v);
//                            });
//
//                    var kStyle = '<br><span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:#0CF49B;"></span>';
//
//                    var relVal = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#0CF49B;"></span>' + params[0].axisValue;
//                    for (var i = 0, l = params.length; i < l; i++) {
//                        relVal += '<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#0CF49B;"></span>' + params[i].seriesName + ': ';
//
//                        if (params[i].seriesType == "candlestick") {
//                            relVal += kStyle + '开: ' + params[i].data[1] + kStyle + '收: ' + params[i].data[2] + kStyle + '低: ' + params[i].data[3] + kStyle + '高: ' + params[i].data[4];
//                        } else {
//                            var d = params[i].data;
//                            if(parseFloat(d).toString() =="NaN"){
//                                relVal += params[i].data;
//                            }else {
//                                relVal += params[i].data.toFixed(2);
//                            }
//                        }
//                    }
//                    return relVal;
//                },
//                axisPointer: {
//                    animation: false,
//                    type: 'cross',
//                    lineStyle: {
//                        color: '#376df4',
//                        width: 2,
//                        opacity: 1
//                    }
//                }
//            },
//            xAxis: {
//                type: 'category',
//                data: dates,
//                axisLine: {
//                    lineStyle: {
//                        color: '#8392A5'
//                    }
//                }
//            },
//            yAxis: {
//                scale: true,
//                axisLine: {
//                    lineStyle: {
//                        color: '#8392A5'
//                    }
//                },
//                splitLine: {
//                    show: false
//                }
//            },
//            grid: {
//                bottom: 80
//            },
//            dataZoom: [{
//                textStyle: {
//                    color: '#8392A5'
//                },
//                handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
//                handleSize: '80%',
//                dataBackground: {
//                    areaStyle: {
//                        color: '#8392A5'
//                    },
//                    lineStyle: {
//                        opacity: 0.8,
//                        color: '#8392A5'
//                    }
//                },
//                handleStyle: {
//                    color: '#fff',
//                    shadowBlur: 3,
//                    shadowColor: 'rgba(0, 0, 0, 0.6)',
//                    shadowOffsetX: 2,
//                    shadowOffsetY: 2
//                }
//            }, {
//                type: 'inside'
//            }],
//            animation: false,
//            series: [{
//                type: 'candlestick',
//                name: 'K线',
//                data: data,
//                itemStyle: {
//                    normal: {
//                        color: '#FD1050',
//                        color0: '#0CF49B',
//                        borderColor: '#FD1050',
//                        borderColor0: '#0CF49B'
//                    }
//                },
//                markLine: {
//                    data: [{
//                        yAxis: valueToday.close
//                    }
//                    ]
//                }
//            },
//                {
//                    name: 'MA5',
//                    type: 'line',
//                    data: calculateMA(5, data),
//                    smooth: true,
//                    showSymbol: false,
//                    lineStyle: {
//                        normal: {
//                            width: 1
//                        }
//                    }
//                }/*,
//                 {
//                 name: 'MA10',
//                 type: 'line',
//                 data: calculateMA(10, data),
//                 smooth: true,
//                 showSymbol: false,
//                 lineStyle: {
//                 normal: {
//                 width: 1
//                 }
//                 }
//                 },
//                 {
//                 name: 'MA20',
//                 type: 'line',
//                 data: calculateMA(20, data),
//                 smooth: true,
//                 showSymbol: false,
//                 lineStyle: {
//                 normal: {
//                 width: 1
//                 }
//                 }
//                 },
//                 {
//                 name: 'MA30',
//                 type: 'line',
//                 data: calculateMA(30, data),
//                 smooth: true,
//                 showSymbol: false,
//                 lineStyle: {
//                 normal: {
//                 width: 1
//                 }
//                 }
//                 }*/
//            ]
//        };
//        myChart.setOption(option);
//        var zr = myChart.getZr();
//        zr.on('mouseout', function(){
//            var valueToday = dataFromApi.Data[dataFromApi.Data.length - 1];
//            $.each(valueToday,function(k,v){
//                $("#price-k-" +k).text(v);
//            });
//
//        });
//        /*
//         myChart.on('mouseover', function(param){
//         if(param.seriesType == "candlestick"){
//         var valuePointTo = dataFromApi.Data[param.dataIndex];
//         $.each(valuePointTo,function(k,v){
//         $("#price-k-" +k).text(v);
//         });
//         }
//         });
//
//         myChart.on('mouseout', function(param){
//         if(param.seriesType == "candlestick"){
//         var valueToday = dataFromApi.Data[dataFromApi.Data.length - 1];
//         $.each(valueToday,function(k,v){
//         $("#price-k-" +k).text(v);
//         });
//
//         }
//         });
//         */
//    }
//    var url = baseUrl + "/candlestick?coinType="+coinType +"&gap=" + gap + "&count=" + count;
//    var url = 'https://aioq.cn/golang' + "/candlestick?coinType="+coinType +"&gap=" + gap + "&count=" + count;
//
//    $.ajax({
//        type: 'get',
//        url: url,
//        //async: false,//同步
//        success : function(msg) {
//            //alert(JSON.strinify(msg));
//            setOnUi(msg);
//        },
//        error : function(errMsg) {
//            //不知道该干啥
//        }
//    });
//}
//切换1min 5min
$('.group').click(function(){
    $(this).addClass('select').siblings().removeClass('select');
    var coinType = $('.active').attr('data-product-abbreviation-name');
    var gap = $(this).attr('gap');
    setCandlestick(coinType,gap,30);
});
var lever="{$user.lever}";

$(".symbolitem").click(function () {
    $(this).addClass("active");
    $(this).siblings().removeClass("active");
    $('.default_active').addClass('select').siblings().removeClass('select');
    //产品名称
    var name= $(this).attr('data-product-abbreviation-name');
    var now_price=$(this).find('.price').text();
    $('.product_name').text($(this).find('.title').text());
    $('.product_price_change').attr('data-product-abbreviation',name).text(now_price);
    $('.up_down_val').attr('data-product-up-down-val',name);
    $('.up_down').attr('data-product-up-down',name);
    var form_id='#'+name+'_id';
    var contract_id='#'+name+'_contract';
    var min_hand_id='#'+name+'_min_hand';
    var fee_id='#'+name+'_fee';
    var wave_id='#'+name+'_wave';

    var form_id_val=$(form_id).val();
    var contract_val=$(contract_id).val();
    var min_hand_val=$(min_hand_id).val();
    var fee_val=$(fee_id).val();
    var wave_val=$(wave_id).val();
    $('.contract').text(contract_val);
    $('.min_hand').text(min_hand_val);
    $('.fee').text(fee_val);
    $('.point_wave').val(wave_val);
    $('.form_id').val(form_id_val);

    $('.target_profit').text(now_price-(-wave_val));
    $('input[name="target_profit"]').val(now_price-(-wave_val));

    $('.stop_loss').text(now_price-wave_val);
    $('input[name="stop_loss"]').val(now_price-wave_val);
    countRange(now_price,name);
    setCandlestick(name,"1day",30);
});
//建仓取消按钮
$(".models .m-cancel").click(function () {
    if( $("input[name='target_profit_check']").is(':checked') ){
        $("input[name='target_profit_check']").removeAttr('checked');
        $("input[name='target_profit']").val('');
        $(".switchone .chosecon").hide();
        layui.form.render('checkbox');
    }
    if( $("input[name='stop_loss_check']").is(':checked') ){
        $("input[name='stop_loss_check']").removeAttr('checked');
        $("input[name='stop_loss']").val('');
        $(".switchtwo .chosecon").hide();
        layui.form.render('checkbox');
    }
    $(".models").hide();
});
//设置建仓方向
function set_direction(val,number){
    if(number==1){
        $('.win_des').text('大于');
        $('.loss_des').text('小于');
    }else{
        $('.win_des').text('小于');
        $('.loss_des').text('大于');
    }
    $('.order_direction').text(val);
    $('.form_direction').val(number);
    $('.promise_money').text(0.00);
    $(".models").show();
    $('.shosu').val('').focus();
}
//手数失焦事件，必须数字，并计算保证金
$(".models .shosu").blur(function () {
    var vals=$(this).val();
    if(isNotANumber(vals)==true){
        if(vals<0){
            $(".shosu").val(0);
        }else if(vals>0){
            var now_price=$('.product_price_change').first().text();
            var contract= $('.contract').first().text();
            var money=now_price*contract*vals/lever;
//                console.log(now_price);
//                console.log(contract);
            $('.promise_money').text(math_floor(money));
        }
    }else{
        $(".shosu").val(0);
    }
});
function isNotANumber(inputData) {
    //isNaN(inputData)不能判断空串或一个空格
    //如果是一个空串或是一个空格，而isNaN是做为数字0进行处理的，而parseInt与parseFloat是返回一个错误消息，这个isNaN检查不严密而导致的。
    if(parseFloat(inputData).toString() == "NaN") {
        return false;
    } else {
        return true;
    }
}
function close_order(oid){
    layer.confirm('确认要平仓吗？',function(index){
        //发异步删除数据
        var load = layer.load();
        $.ajax({
            url:'/index/Trade/close_order',
            data:{oid:oid},
            type:'post',
            dataType:'json',
            success:function(res){
                layer.close(load);
                if(res['status']==1){

                    layer.msg(res['msg'],{icon:1,time:1000},function(){
                        var tr='.'+oid;
                        $(tr).remove();
                        handle_money(res.info.money,res.info.promise_money);
                    });
                }else{
                    layer.msg(res['msg'],{icon: 2,time:1000});
                }
            }
        });
    });
}
function math_floor(number,per){
    number = parseFloat(number);
//        console.log(number);
    return number.toFixed(2);
}
//    var last_money=0;

//计算持仓单盈亏
function count_profit(){
//        var all=0;
    $('tbody tr').each(function(){
        var buy_price=$(this).children('.buy_price').text();
        var now_price=$(this).children('.now_price').text();
        if(buy_price==now_price){
            return;
        }
        var direction=$(this).children('.direction').text();
        var contract=$(this).children('.order_contract').text();
        var hand=$(this).children('.hand').text();
        var amount=(now_price-buy_price)*contract*hand;
        var color;
//            console.log(direction=='买入');
        if(direction=='买入'){
            if(now_price>=buy_price){
                color='#e54c4c';
            }else if(now_price<buy_price){
                color='#4bbb82';
            }
        }else{
            if(now_price>=buy_price){
                color='#4bbb82';
            }else if(now_price<buy_price){
                color='#e54c4c';
            }
            amount=-amount;
        }
//            all=all+parseFloat(amount);

//            console.log(color);
        $(this).children('.profit').text(math_floor(amount)).attr("style","color:"+color+";");
        $(this).children('.now_price').attr("style","color:"+color+";");
    });
//        handle_money(all-last_money,0);
//        last_money=all;
}
//计算止盈止损
function count_wave(price){
    var point_wave=$('#point_wave').val();
    var form_direction=$('.form_direction').val();
    if(form_direction==1){
        $('.target_profit').text(price-(-point_wave));
        $('input[name="target_profit"]').val(price-(-point_wave));
        $('.stop_loss').text(price-point_wave);
        $('input[name="stop_loss"]').val(price-point_wave);
    }else{
        $('.target_profit').text(price-point_wave);
        $('input[name="target_profit"]').val(price-point_wave);
        $('.stop_loss').text(price-(-point_wave));
        $('input[name="stop_loss"]').val(price-(-point_wave));
    }


    //计算保证金
    var hand=$(".models .shosu").val();
    if(isNotANumber(hand)==true){
        if(hand<0){
            $(".shosu").val(0);
        }else if(hand>0){
            var now_price=$('.product_price_change').first().text();
            var contract= $('.contract').first().text();
            var money=now_price*contract*hand/lever;
//                            console.log(now_price);
//                console.log(contract);
            $('.promise_money').text(math_floor(money));
        }
    }
}
var openPrice = [];
function countRange(nowPrice,productAbbreviation){
    var range=nowPrice-openPrice[productAbbreviation];
    var range_per=range/openPrice[productAbbreviation]*100;
    var up_down_name=  "[data-product-up-down="+productAbbreviation+"]";
    var price_color=  "[data-color="+productAbbreviation+"]";
    var up_down_val_name=  "[data-product-up-down-val="+productAbbreviation+"]";
    var color;
    if(nowPrice>openPrice[productAbbreviation]){
        color='#e54c4c';
    }else if(nowPrice<openPrice[productAbbreviation]){
        color='#4bbb82';
    }
    $(up_down_name).text(math_floor(range)).attr("style","color:"+color+";");
    $(up_down_val_name).text(math_floor(range_per)).parent().attr("style","color:"+color+";");
    $(price_color).attr("style","color:"+color+";");
}
function handle_money(money,promise_money){
    money=math_floor(money);
    promise_money=math_floor(promise_money);
//        console.log(money);
//        console.log(promise_money);
    var user_money= math_floor($('#user_money').text());
    var user_promise_money= math_floor($('#user_promise_money').text());
    var user_real_money= math_floor($('#user_real_money').text());
    var my_number_money=toRead(x100(user_money)+x100(money));
    var my_promise_money=toRead(x100(user_promise_money)+x100(promise_money));
    var my_real_money=toRead(x100(user_real_money)+x100(money)-x100(promise_money));
    $('#user_money').text(my_number_money);
    $('#user_promise_money').text(my_promise_money);
    $('#user_real_money').text(my_real_money);
}
function x100(x){
    return Math.floor((+x)*100);
}
function toRead(x){
    x = x + '';
    return x.slice(0,-2) + '.'  + x.slice(-2);
}
$(function  () {
    var layer;
    var loadingFirst;
    var loadingSecond;
    function prepareWs(){
        var url = baseUrl + "/openPrice";
//        url = 'https://aioq.cn/golang/openPrice';
//        console.log(url);
        //获取产品开盘价
        $.ajax({
            type: 'get',
            url: url,
            //async: false,//同步
            success : function(data) {
                for(let i in data){
                    openPrice[i] =data[i]['USD'];
                }
            },
            error : function(errMsg) {
                //不知道该干啥
                layer.msg('网络波动',{icon: 1,time:1000},function(){
                    window.location.href="/index/User/index"
                });
            }
        });
        var uid="{$user.uid}";
        var wsUrl ='ws:';
        if(loc.protocol == 'https:')
            wsUrl = 'wss:'
        wsUrl += '//' + loc.host + '/golang/ws?uid=' + uid;
//        wsUrl= 'wss://aioq.cn/golang/ws?uid=4';


        var ws = new WebSocket(wsUrl)
        //var ws = new WebSocket("ws://47.90.122.200:8080/ws?uid="+uid);
        console.log(wsUrl);
        ws.onopen = function()
        {
            layer.close(loadingFirst);
            loadingSecond = layer.load(2, { //icon支持传入0-2
                shade: [0.5, 'gray'], //0.5透明度的灰色背景
                content: '数据加载中...',
                success: function (layero) {
                    layero.find('.layui-layer-content').css({
                        'padding-top': '39px',
                        'width': '14rem',
                        'color':'white',
                        'font-size':'2rem'

                    });
                }
            });
//                console.log('已连接');
            // Web Socket 已连接上，使用 send() 方法发送数据
            //ws.send("发送数据");
        };

        ws.onmessage = function (evt)
        {
            //            console.log(evt);
//            console.log(evt.data);
            var data=JSON.parse(evt.data);
            if(data.status){
                //总后台强平
                if(data.status==101){
                    layer.msg(data.msg,{icon: 2,time:3000},function(){
                        var tr='.'+data.oid;
                        $(tr).remove();
                        handle_money(data.money,data.promise_money);
                    });
                }
                //爆仓,止盈平仓，止损平仓
                if(data.status==102){
                    layer.msg(data.msg,{icon: 2,time:3000},function(){
                        var tr='.'+data.oid;
                        $(tr).remove();
                        handle_money(data.money,data.promise_money);
                    });
                }
                //资金变化
                if(data.status==201){
                    handle_money(data.money,data.promise_money);
                }
            }else{
                var active_name = $('.product_price_change').first().attr('data-product-abbreviation');
//                console.log(active_name);
                $.each(data,function(k,v){
                    var abbreviation='.'+k;
                    var new_price=v['USD'];
                    if(k==active_name){
                        //计算止盈止损
                        count_wave(new_price);
//                        var opt = myChart.getOption();
//                        if(opt){
//                            opt.series[0].markLine.data[0].yAxis = new_price;
//                            myChart.clear();
//                            myChart.setOption(opt);
//                        }
                    }
                    //计算涨幅跌幅
                    countRange(new_price,k);
                    //固定产品位置
                    $(abbreviation).text(new_price);
                    //变化的产品位置
                    var name=  "[data-product-abbreviation="+k+"]";
                    $(name).text(new_price);
                });
                //计算持仓单输赢
                count_profit();
                layer.close(loadingSecond);
            }
        };
    }
    layui.use(['layer', 'form'], function () {
        layer = layui.layer;
        var form = layui.form;
        loadingFirst = layer.load(2, { //icon支持传入0-2
            shade: [0.5, 'gray'], //0.5透明度的灰色背景
            content: '连接服务器...',
            success: function (layero) {
                layero.find('.layui-layer-content').css({
                    'padding-top': '39px',
                    'width': '14rem',
                    'color':'white',
                    'font-size':'2rem'

                });
                prepareWs();
            }
        });
        form.on('switch(checks)', function(data){
//                console.log(data.elem.checked); //开关是否开启，true或者false
            if(data.elem.checked==true){
                $(".switchone .chosecon").show();
            }else{
                $(".switchone .chosecon").hide();
            }
        });
        form.on('switch(checks-t)', function(data){
//                console.log(data.elem.checked); //开关是否开启，true或者false
            if(data.elem.checked==true){
                $(".switchtwo .chosecon").show();
            }else{
                $(".switchtwo .chosecon").hide();
            }
        });
        form.verify({
            hand: function(value){
                if(value<=0){
                    return '请输入正确的手数';
                }
            }
        });

        form.on('submit(create_order)', function(data){
//                console.log(data.field);
//                return false;
            var load = layer.load();
            $('input[type="submit"]').attr("disabled",true);
            $.post("/index/Trade/create_order",data.field,function(res){
                layer.close(load);
                if(res.status==0){
                    layer.msg(res.msg,{icon: 2,time:1000},function(){
                        $('input[type="submit"]').removeAttr("disabled");
                    });
                }else{
                    layer.msg(res.msg,{icon: 1,time:1000},function(){
                        keep_order_list_add(res.info);
                        handle_money(-res.info.fee,res.info.money);

                        // window.location.href="/index/User/index"
                    });
                }
            },'json');
            return false;
        });

    });
    setCandlestick("BTC","1day",30);//1.货币, 2. day,hour,minute 按天，小时，分钟. 3. 几条柱子
});
function keep_order_list_add(data){
//        console.log(data);
    var html='<tr class="'+data.oid+'">';
    html+='<td>'+data.order_sn+'</td>';
    html+='<td>'+data.product_name+'</td>';
    html+='<td class="money">'+math_floor(data.money)+'</td>';
    html+='<td class="buy_price">'+math_floor(data.buy_price)+'</td>';
    html+='<td class="now_price '+data.product_abbreviation+'">'+data.now_price+'</td>';
    if(data.direction==1){
        html+='<td style="color: #e54c4c;" class="direction">买入</td>';
    }else{
        html+='<td style="color: #4bbb82;" class="direction">卖出</td>';
    }
    html+='<td class="order_contract">'+math_floor(data.contract)+'</td>';
    html+='<td class="hand">'+math_floor(data.hand)+'</td>';
    html+='<td class="profit">0.00</td>';
    html+='<td>'+data.add_time+'</td>';
    html+='<td><button style="background-color: #e54c4c;color: white;border-radius:8%;width: 3rem;border:none" onclick="close_order('+data.oid+')">平仓</button></td></tr>';
    $(".keep_order_list").prepend(html);
    $(".models .m-cancel").click();
}
</script>